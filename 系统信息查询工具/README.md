# 系统信息查询工具 📊

> **System Information Query Tool**  
> 支持本地和远程Windows计算机系统信息查询的PowerShell工具

## 📋 功能概述

这是一个专为IT运维和技术支持设计的PowerShell脚本，能够快速收集本地或远程Windows计算机的关键系统信息，并自动复制到剪切板，方便用户直接发送给IT工程师进行故障诊断和技术支持。

### ✨ 主要特性

- 🖥️ **本地/远程查询**：支持本地计算机和远程Windows计算机信息查询
- 🔗 **高效连接**：使用基于DCOM的CIM会话进行远程连接，性能优异
- 🌐 **网络配置**：智能检测所有活动网卡（包括虚拟网卡）的IP、MAC地址和DNS服务器
- 💾 **系统详情**：操作系统版本、架构、制造商、型号、内存信息
- 🔐 **凭据支持**：支持使用自定义凭据连接远程计算机
- 📋 **自动复制**：结果自动复制到剪切板，可直接粘贴发送
- 💾 **文件保存**：支持将信息保存到文本文件
- 🎨 **友好界面**：彩色输出，详细的连接状态和错误提示
- 🐛 **调试模式**：支持`-OutputDebug`参数输出详细调试信息
- 🧠 **智能过滤**：自动过滤系统虚拟账户，只显示真实用户会话
- 🕒 **超时控制**：可配置的远程连接超时时间（5-300秒）
- 🔍 **网络连通性检测**：自动检测目标计算机的网络连通性
- 👥 **用户会话管理**：智能识别当前登录用户，区分本地和域用户
- 🏠 **管理员组分类**：清晰区分本地管理员组成员和域管理员组成员
- 📊 **性能优化**：使用高效的CIM查询，支持批量操作和性能监控

## 🚀 快速开始

### 本地查询

```powershell
# 查询本地计算机信息
.\Get-SystemInfo.ps1

# 查询本地信息并保存到文件
.\Get-SystemInfo.ps1 -SaveToFile -OutputPath "LocalInfo.txt"

# 输出详细调试信息
.\Get-SystemInfo.ps1 -OutputDebug
```

### 远程查询

```powershell
# 查询远程计算机（使用当前用户凭据）
.\Get-SystemInfo.ps1 -ComputerName "SERVER01"

# 使用IP地址查询远程计算机
.\Get-SystemInfo.ps1 -ComputerName "192.168.1.100"

# 使用指定凭据查询远程计算机
$cred = Get-Credential
.\Get-SystemInfo.ps1 -ComputerName "SERVER01.domain.com" -Credential $cred

# 远程查询并保存到文件
.\Get-SystemInfo.ps1 -ComputerName "SERVER01" -SaveToFile -OutputPath "Server01_Info.txt"

# 远程查询并输出详细调试信息
.\Get-SystemInfo.ps1 -ComputerName "IMZSPC1097" -OutputDebug

# 设置连接超时时间（秒）
.\Get-SystemInfo.ps1 -ComputerName "SERVER01" -Timeout 60
```

## 📝 输出示例

### 本地查询示例

```
=================================
    系统信息查询工具
  System Information Tool
=================================

开始本地系统信息查询...
正在获取计算机信息...
正在获取用户信息...
正在获取网络信息...
正在获取系统详细信息...
正在获取Administrators组成员...

计算机名 (FQDN): PC001.company.com
当前登录用户: COMPANY\john.doe

网络适配器信息:
------------------------------
网卡 1 - 以太网 (物理网卡)
  IP地址: 192.168.1.100
  MAC地址: AA-BB-CC-DD-EE-FF
  DNS服务器: 192.168.1.1, 8.8.8.8

网卡 2 - vEthernet (external) (虚拟网卡)
  IP地址: 192.168.124.11
  MAC地址: 00-15-5D-7C-0B-00
  DNS服务器: 192.168.124.7, 223.5.5.5

系统详细信息:
------------------------------
操作系统: Microsoft Windows 11 专业版
系统版本: 10.0.22631
系统架构: 64-bit
制造商: Dell Inc.
型号: OptiPlex 7090
总内存: 16.00 GB

Administrators组成员:
------------------------------
🏠 本地成员 (2 个):
  1. Administrator [User]
  2. tornadoami [User]

🌐 域成员 (1 个):
  1. Domain Admins [Group]

📊 总计: 3 个Administrators组成员

=================================

🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉
🎯 以上信息已自动复制到剪切板！
📋 请直接在IM软件（如钉钉、企业微信、飞书等）中粘贴发送给IT工程师
🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉
```

### 远程查询示例

```
=================================
    系统信息查询工具
  System Information Tool
  远程目标: SERVER01.company.com
=================================

开始远程系统信息查询...
正在检测网络连通性...
✓ 网络连通性检测成功
正在通过WMI获取远程系统信息...
正在建立CIM连接...
CIM连接建立成功
正在获取当前登录用户...
正在获取网络适配器信息...
正在获取Administrators组成员...

计算机名 (FQDN): SERVER01
当前登录用户: COMPANY\admin

网络适配器信息:
------------------------------
网卡 1 - 以太网 (物理网卡)
  IP地址: 192.168.1.50
  MAC地址: 00-50-56-C0-00-01
  DNS服务器: 192.168.1.1, 192.168.1.2

系统详细信息:
------------------------------
操作系统: Microsoft Windows Server 2022 Standard
系统版本: 10.0.20348
系统架构: 64-bit
制造商: VMware, Inc.
型号: VMware Virtual Platform
总内存: 8.00 GB

Administrators组成员:
------------------------------
🏠 本地成员 (1 个):
  1. Administrator [User]

🌐 域成员 (2 个):
  1. Domain Admins [Group]
  2. Enterprise Admins [Group]

📊 总计: 3 个Administrators组成员

=================================

🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉
🎯 以上信息已自动复制到剪切板！
📋 请直接在IM软件（如钉钉、企业微信、飞书等）中粘贴发送给IT工程师
🖥️  远程计算机: SERVER01.company.com | 连接方式: WMI
🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉
```

## 🔧 参数说明

| 参数 | 类型 | 说明 | 默认值 |
|------|------|------|--------|
| `-ComputerName` | String | 目标计算机名称或IP地址，留空则查询本地计算机 | `""` |
| `-Credential` | PSCredential | 用于连接远程计算机的凭据 | `$null` |
| `-SaveToFile` | Switch | 是否保存信息到文件 | `$false` |
| `-OutputPath` | String | 输出文件路径 | `"SystemInfo.txt"` |
| `-Force` | Switch | 强制执行，跳过确认提示 | `$false` |
| `-Timeout` | Int | 远程连接超时时间（秒），范围5-300秒 | `30` |
| `-OutputDebug` | Switch | 输出详细的调试信息，便于故障排查和性能分析 | `$false` |

## 🔗 远程连接说明

### 连接方式

脚本使用高效的基于DCOM的CIM会话进行远程连接：

1. **CIM (Common Information Model)** - 主要连接方式
   - 基于DCOM协议，兼容性好
   - 适用于所有Windows版本
   - 无需额外配置，开箱即用
   - 性能优异，连接速度快

### 连接测试流程

```
网络连通性测试 → CIM连接建立 → 获取系统信息
     ↓               ↓               ↓
   PING测试      CIM会话创建      完成信息收集
```

## 🌐 网络检测说明

脚本能够智能检测各种网络适配器并获取完整配置信息：

### ✅ 支持的网卡类型
- 物理以太网卡（IP、MAC、DNS）
- 无线网卡（IP、MAC、DNS）
- Hyper-V虚拟网卡（IP、MAC、DNS）
- VMware虚拟网卡（IP、MAC、DNS）
- Docker网络适配器（IP、MAC、DNS）

### ❌ 自动过滤的网卡
- 回环适配器 (Loopback)
- Teredo隧道适配器
- ISATAP适配器
- 蓝牙网络适配器

### 🔍 DNS服务器检测
- **本地查询**：使用 `Get-DnsClientServerAddress` 获取DNS配置
- **远程查询**：通过CIM `Win32_NetworkAdapterConfiguration` 获取DNS信息
- **智能过滤**：自动过滤本地回环地址（127.0.0.1、::1）
- **显示逻辑**：区分已配置DNS和未配置/自动获取的情况

## 💼 适用场景

### 🎯 IT运维支持
- **远程技术支持**：快速获取用户电脑或服务器信息
- **故障诊断**：收集系统信息进行问题分析
- **资产管理**：批量收集设备硬件和软件信息
- **网络监控**：检查远程设备的网络配置状态
- **性能分析**：使用调试模式分析查询性能
- **批量运维**：支持多台计算机的批量信息收集

### 👥 最终用户
- **问题报告**：向IT部门提供详细的系统信息
- **兼容性检查**：软件安装前的系统环境验证
- **网络排查**：诊断本地网络连接问题
- **一键复制**：自动复制信息到剪切板，方便发送

### 🏢 企业环境
- **标准化流程**：统一的系统信息收集标准
- **批量管理**：同时查询多台计算机的信息
- **合规审计**：定期收集系统配置信息
- **远程运维**：无需物理接触即可获取设备信息
- **安全监控**：检查管理员组成员和用户会话

## ⚙️ 系统要求

### 本地查询
- **操作系统**：Windows 7 及以上版本
- **PowerShell**：5.1 及以上版本
- **权限**：普通用户权限即可

### 远程查询
- **目标系统**：Windows 7/Server 2008 及以上版本
- **网络连接**：能够访问目标计算机
- **权限要求**：目标计算机的管理员权限
- **服务要求**：目标计算机启用WMI和DCOM服务

### 防火墙端口
- **WMI/DCOM**：TCP 135 + 动态端口范围

## 🔍 技术实现

### 核心技术栈
- **PowerShell CIM/WMI**：系统信息获取
- **Net-* Cmdlets**：网络配置查询
- **Get-DnsClientServerAddress**：DNS服务器查询
- **System.Net.Dns**：FQDN解析
- **Set-Clipboard**：剪切板操作
- **ADSI**：本地管理员组成员查询
- **Win32_LogonSession**：用户会话管理
- **Win32_GroupUser**：管理员组成员查询

### 关键特性
- **高效连接模式**：使用基于DCOM的CIM会话，连接速度快
- **智能网卡检测**：自动识别物理和虚拟网卡，获取DNS配置
- **凭据管理**：安全的远程认证处理
- **错误处理**：完善的异常捕获和处理
- **编码支持**：正确显示中文字符
- **跨版本兼容**：支持不同Windows版本
- **调试支持**：详细的调试信息输出
- **性能监控**：实时显示查询耗时和性能统计
- **智能过滤**：自动过滤系统虚拟账户和无效会话

## 📁 文件结构

```
系统信息查询工具/
├── Get-SystemInfo.ps1    # 主脚本文件（支持本地/远程查询）
└── README.md            # 本文档
```

## 🐛 故障排除

### 本地查询问题

**Q: 显示"未找到活动的网络连接"**  
A: 这通常是因为网卡驱动问题或网络配置异常，脚本会尝试检测所有可用的网络适配器。

**Q: 剪切板复制失败**  
A: 可能是PowerShell版本较低或系统权限限制，可以使用 `-SaveToFile` 参数保存到文件，或手工复制截图。

**Q: 中文显示乱码**  
A: 脚本已设置UTF8编码，如仍有问题请检查PowerShell控制台编码设置。

### 远程查询问题

**Q: "无法连接到远程计算机"**  
A: 检查网络连通性、防火墙设置和目标计算机是否在线。

**Q: "WMI连接测试失败"**  
A: 检查WMI服务状态和DCOM配置，确保防火墙允许WMI通信。

**Q: "用户权限不足或凭据无效"**  
A: 确保使用的凭据具有目标计算机的管理员权限。

**Q: 远程查询速度慢**  
A: 可以尝试以下优化方法：
1. 使用 `-OutputDebug` 参数查看详细调试信息
2. 检查DNS配置，确保正向和反向解析一致
3. 调整 `-Timeout` 参数设置合适的超时时间

**Q: 调试信息显示"DNS解析失败"**  
A: 这是正常现象，脚本会继续尝试其他连接方式。如果网络连接正常但查询失败，请检查目标计算机的WMI服务状态。

**Q: 调试模式下的性能分析**  
A: 使用 `-OutputDebug` 参数可以查看：
- 网络连通性测试耗时
- CIM会话建立时间
- 各类查询操作的性能统计
- 用户会话和网络适配器查询的详细过程

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](../LICENSE) 文件

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个工具！

### 开发规范
- 遵循PowerShell最佳实践
- 添加适当的错误处理
- 保持代码注释完整
- 确保跨版本兼容性

## 📞 技术支持

如有问题或建议，请通过以下方式联系：

- 📧 Email: [1426693333@qq.com]
- 🐛 Issues: [[GitHub Issues链接](https://github.com/iamtornado/common_powershell_scripts/issues)]
- 💬 讨论: [[GitHub Discussions链接](https://github.com/iamtornado/common_powershell_scripts/discussions)]

---

**版本**: 3.1  
**最后更新**: 2025-08-01  
**作者**: tornadoami

## 📈 版本历史

### v3.1 (2025-08-01)
- 🚀 **性能优化**：使用基于DCOM的CIM会话，提升连接性能
- 🔧 **新增调试模式**：添加 `-OutputDebug` 参数输出详细调试信息
- 🕒 **超时控制**：为远程连接添加可配置的超时时间
- 📈 **性能提升**：优化网络适配器和用户会话查询性能
- 🎨 **界面优化**：改进彩色输出和状态显示
- 🧠 **智能过滤**：增强系统虚拟账户过滤逻辑
- 📊 **性能监控**：添加详细的性能统计和耗时分析

### v3.0 (2025-08-01)
- ✨ **重构连接方式**：完全基于CIM会话，移除WinRM依赖
- 🔧 **新增参数**：添加 `-Timeout` 和 `-OutputDebug` 参数
- 🏠 **管理员组成员分类**：清晰区分本地成员和域成员
- 🎨 **醒目剪切板提示**：彩色图标和背景色提示信息复制状态
- 📊 **增强错误处理**：更详细的错误信息和故障排除建议

### v2.0 (2025-07-31)
- ✨ 新增远程计算机查询功能
- 🔗 支持CIM和WMI连接方式
- 🔐 添加凭据认证支持
- 🎯 智能连接方式选择
- 📊 增强错误处理和状态显示
- 📝 完善文档和使用示例

### v1.0 (2025-07-31)
- 🎉 首次发布
- 🖥️ 本地系统信息查询
- 🌐 网络适配器智能检测
- 📋 自动剪切板复制
- 💾 文件保存功能