# 字体批量安装工具 🔤

> **Font Batch Installation Tool**  
> 快速批量安装字体文件到Windows系统字体目录

## 📋 功能概述

这是一个专为IT运维和系统管理设计的PowerShell脚本，能够批量安装字体文件（.ttf、.ttc、.otf）到Windows系统字体目录。脚本采用双重检测机制（文件+注册表），智能跳过已完整安装的字体，并可自动修复不完整的安装状态（如文件存在但未注册，或注册表存在但文件缺失）。

### ✨ 主要特性

- 🔤 **批量安装**：支持递归扫描指定文件夹中的所有字体文件
- 📁 **多格式支持**：支持 .ttf、.ttc、.otf 三种常见字体格式
- ⚡ **快速安装**：使用同步复制操作，安装速度快
- 🎯 **智能检测**：双重检测机制，同时检查字体文件是否存在和注册表中是否已注册，避免重复安装
- 🔧 **自动修复**：智能修复不完整的字体安装状态（文件存在但未注册，或注册表存在但文件缺失）
- 📝 **详细输出**：实时显示安装进度和结果
- 🛡️ **错误处理**：完善的错误处理机制，单个字体失败不影响整体处理
- 🔐 **权限检查**：自动检查管理员权限，确保安装成功
- 📊 **统计信息**：安装完成后显示详细的统计信息

## 🚀 快速开始

### 前置要求

1. **PowerShell版本**：PowerShell 5.1 或更高版本
2. **管理员权限**：必须以管理员身份运行脚本
3. **字体文件**：准备包含字体文件的文件夹

### 使用方法

#### 方法一：使用默认路径

```powershell
# 以管理员身份运行PowerShell，然后执行：
.\Install-Fonts.ps1
```

默认会从 `D:\Myse_Fonts` 路径安装字体。

#### 方法二：指定自定义路径

```powershell
# 指定字体源文件夹路径
.\Install-Fonts.ps1 -FontSourcePath "C:\MyFonts"
```

### 参数说明

| 参数 | 类型 | 必需 | 默认值 | 说明 |
|------|------|------|--------|------|
| `FontSourcePath` | String | 否 | `D:\Myse_Fonts` | 字体源文件夹路径 |

## 📖 使用示例

### 示例1：安装默认路径的字体

```powershell
# 以管理员身份运行
.\Install-Fonts.ps1
```

**输出示例：**
```
========================================
    字体批量安装工具
========================================

字体源路径: D:\Myse_Fonts

找到 15 个字体文件，开始安装...

正在安装字体: Arial.ttf - 成功
正在安装字体: TimesNewRoman.ttf - 成功
字体已存在且已注册，跳过: Calibri.ttf
...

========================================
字体安装完成
========================================
已安装: 12
已跳过: 3
总计: 15
```

### 示例2：从自定义路径安装字体

```powershell
.\Install-Fonts.ps1 -FontSourcePath "C:\Fonts\MyCollection"
```

### 示例3：安装网络共享中的字体

```powershell
.\Install-Fonts.ps1 -FontSourcePath "\\Server\Fonts\Shared"
```

## 🔧 工作原理

1. **路径验证**：检查指定的字体源路径是否存在
2. **权限检查**：验证当前是否以管理员身份运行
3. **字体扫描**：递归扫描指定文件夹中的所有字体文件（.ttf、.ttc、.otf）
4. **重复检测**：双重检测机制
   - 检查字体文件是否已存在于 `C:\Windows\Fonts` 目录
   - 检查注册表中是否已在 `HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts` 注册
   - 只有当两者都存在时才跳过，否则进行安装或修复
5. **文件复制**：将缺失的字体文件复制到 `C:\Windows\Fonts` 目录
6. **注册表注册**：在注册表中创建缺失的字体注册项
7. **智能修复**：自动修复不完整的安装状态
   - 文件存在但注册表缺失 → 只创建注册表项
   - 注册表存在但文件缺失 → 只复制文件
   - 两者都缺失 → 完整安装（复制文件 + 创建注册表项）
8. **结果统计**：显示安装、跳过和失败的统计信息

## 🔍 双重检测机制说明

脚本采用双重检测机制，确保字体完整安装状态的准确性：

### 检测内容

1. **文件检测**：检查 `C:\Windows\Fonts` 目录中是否存在字体文件
2. **注册表检测**：检查 `HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts` 中是否存在字体注册项

### 处理逻辑

| 文件状态 | 注册表状态 | 处理方式 |
|---------|----------|---------|
| ✅ 存在 | ✅ 已注册 | 跳过（完整安装） |
| ✅ 存在 | ❌ 未注册 | 修复：只创建注册表项 |
| ❌ 不存在 | ✅ 已注册 | 修复：只复制文件 |
| ❌ 不存在 | ❌ 未注册 | 完整安装：复制文件 + 创建注册表项 |

### 优势

- ✅ **准确性**：确保字体在Windows系统中完全可用
- ✅ **修复能力**：自动修复不完整的安装状态
- ✅ **高效性**：避免重复操作，只处理缺失的部分
- ✅ **可靠性**：防止因手动操作导致的字体状态不一致

## 📝 支持的字体格式

- **.ttf** - TrueType字体
- **.ttc** - TrueType集合字体
- **.otf** - OpenType字体

## ⚠️ 注意事项

1. **管理员权限**：安装字体需要管理员权限，必须右键选择"以管理员身份运行"
2. **路径格式**：支持本地路径和网络路径（UNC路径）
3. **字体命名**：建议使用标准的字体文件名，避免特殊字符
4. **重复安装**：已完整安装的字体（文件存在且注册表中已注册）会自动跳过，不会覆盖
5. **智能修复**：脚本会自动检测并修复不完整的字体安装状态
6. **系统字体目录**：字体会被安装到 `C:\Windows\Fonts` 目录
7. **注册表位置**：字体注册信息存储在 `HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts`

## 🐛 故障排除

### 问题1：提示"字体源路径不存在"

**原因**：指定的字体源路径不存在或路径错误

**解决方法**：
- 检查路径是否正确
- 确认路径中的文件夹确实存在
- 使用绝对路径而不是相对路径

### 问题2：提示"需要管理员权限"

**原因**：未以管理员身份运行脚本

**解决方法**：
1. 右键点击PowerShell图标
2. 选择"以管理员身份运行"
3. 在管理员PowerShell中执行脚本

### 问题3：字体安装失败

**可能原因**：
- 字体文件损坏
- 磁盘空间不足
- 文件被其他程序占用
- 权限不足

**解决方法**：
- 检查字体文件是否完整
- 确认 `C:\Windows\Fonts` 目录有足够空间
- 关闭可能占用字体文件的程序
- 确认以管理员身份运行

### 问题4：字体安装后无法使用

**可能原因**：
- 需要重启应用程序
- 字体文件格式不支持
- 注册表项创建失败

**解决方法**：
- 重启需要使用字体的应用程序
- 确认字体文件格式为 .ttf、.ttc 或 .otf
- 检查注册表权限

## 📊 输出说明

脚本会显示以下信息：

- **字体源路径**：显示正在使用的字体源文件夹路径
- **找到的字体数量**：显示扫描到的字体文件总数
- **安装进度**：实时显示每个字体的安装状态
  - ✅ **成功**：字体安装或修复成功（绿色）
  - ⚠️ **跳过**：字体已存在且已注册，跳过安装（黄色）
  - ❌ **失败**：字体安装失败（红色）
- **统计信息**：安装完成后的详细统计
  - 已安装：成功安装的字体数量
  - 已跳过：已存在而跳过的字体数量
  - 失败：安装失败的字体数量
  - 总计：扫描到的字体文件总数

## 🔒 安全说明

- 脚本需要管理员权限才能安装字体
- 字体文件会被复制到系统目录，请确保来源可靠
- 建议从可信来源获取字体文件
- 安装前可以先用杀毒软件扫描字体文件夹

## 📄 许可证

此脚本为实用工具，可自由使用和修改。

## 🤝 贡献

欢迎提交问题和改进建议！

## 📞 支持

如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发送邮件反馈

---

**提示**：安装字体后，某些应用程序可能需要重启才能看到新安装的字体。

