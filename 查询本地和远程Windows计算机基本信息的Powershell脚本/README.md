# Windows 计算机信息查询脚本

## 功能介绍

`Get-ComputerBasicInfo.ps1` 是一个用于查询本地和远程Windows计算机基本信息的PowerShell脚本。该脚本专为企业环境设计，针对性能进行了优化，能够快速获取计算机的关键信息。

## 主要功能

- **计算机基本信息**：计算机名、域名、FQDN
- **网络配置信息**：IP地址、MAC地址、默认网关、DNS服务器
- **用户信息**：当前登录用户
- **权限信息**：本地Administrators组成员

## 性能特点

- **本地查询优化**：对本地计算机使用最高效的查询方法
- **远程查询优化**：使用DCOM WMI和ADSI，减少查询次数
- **大型AD环境支持**：限制查询结果数量，避免性能问题
- **智能检测**：自动识别本地IP地址，选择最优查询方式

## 使用方法

### 基本语法

```powershell
.\Get-ComputerBasicInfo.ps1 [-IPAddress <IP地址>] [-OutputDebug]
```

### 参数说明

- **IPAddress** (可选)：目标Windows计算机的IP地址，支持IPv4格式验证
- **OutputDebug** (可选)：开启详细调试信息输出

### 使用示例

#### 查询本地计算机
```powershell
.\Get-ComputerBasicInfo.ps1
```

#### 查询远程计算机
```powershell
.\Get-ComputerBasicInfo.ps1 -IPAddress "192.168.1.100"
```

#### 启用调试模式查询远程计算机
```powershell
.\Get-ComputerBasicInfo.ps1 -IPAddress "192.168.1.100" -OutputDebug
```

## 输出示例

```
======================================
Windows 计算机信息查询结果
查询时间: 2024-01-15 10:30:45
======================================

计算机信息:
  计算机名: WORKSTATION01
  域名: company.local
  FQDN: WORKSTATION01.company.local

当前登录用户:
  COMPANY\john.doe

网络接口信息:

  接口: Intel(R) Ethernet Connection
    IP地址: 192.168.1.100
    MAC地址: 00-15-5D-01-02-03
    默认网关: 192.168.1.1
    DNS服务器: 192.168.1.10, 192.168.1.11

本地管理员组成员:
  - Administrator (User)
  - COMPANY\Domain Admins (Group)
  - COMPANY\IT-Support (Group)

======================================
查询完成 - 信息已复制到剪切板
======================================
```

## 技术实现

### 本地查询方式
- 使用 `Get-CimInstance` 获取系统信息
- 使用 `[System.Security.Principal.WindowsIdentity]::GetCurrent()` 获取当前用户
- 使用 `Get-LocalGroupMember` 获取管理员组成员

### 远程查询方式
- 使用基于DCOM的CIM会话连接远程计算机
- 使用WMI查询系统和网络信息
- 使用ADSI查询管理员组成员（性能更优）
- 限制查询结果数量以提高性能

## 权限要求

### 本地查询
- 需要本地管理员权限以获取完整的系统信息

### 远程查询
- 需要目标计算机的管理员权限
- 需要网络连通性和WMI服务正常运行
- 可能需要配置防火墙允许WMI通信

## 故障排除

### 常见问题

1. **远程连接失败**
   - 检查网络连通性
   - 确认目标计算机WMI服务运行正常
   - 检查防火墙设置
   - 验证用户权限

2. **查询速度慢**
   - 使用 `-OutputDebug` 参数查看详细执行过程
   - 检查网络延迟
   - 确认目标计算机性能状况

3. **权限不足**
   - 确保以管理员身份运行脚本
   - 检查远程计算机的用户权限

### 调试模式

启用 `-OutputDebug` 参数可以查看：
- 详细的执行步骤
- 连接状态信息
- 查询过程详情
- 错误详细信息

## 注意事项

1. **安全性**：脚本需要管理员权限运行，请谨慎使用
2. **网络环境**：在大型企业网络中，可能需要配置网络策略
3. **性能考虑**：脚本已针对大型AD环境进行优化，但仍建议分批查询大量计算机
4. **兼容性**：支持Windows 10/11和Windows Server 2016及以上版本

## 输出格式

查询结果会自动复制到剪切板，方便直接粘贴到IM软件或邮件中发送给IT工程师。输出格式经过精心设计，易于阅读和分析。

## 更新日志

- v1.0：初始版本，支持本地和远程计算机信息查询
- 针对大型AD环境进行性能优化
- 添加详细的调试信息和错误处理